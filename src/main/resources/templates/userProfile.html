<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
        }
        .profile-info {
            margin-bottom: 20px;
        }
        .profile-info label {
            font-weight: bold;
        }
        .profile-info p {
            margin: 5px 0;
        }
        .change-email-form, .change-password-form {
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group button {
            padding: 8px 12px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-account {
            margin-top: 20px;
            text-align: center;
        }
        .delete-account button {
            padding: 8px 20px;
            background-color: #dc3545;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<!--<div class="container">
    <h1>User Profile</h1>
    <div class="profile-info">
        <p><label>Username:</label> <span id="username"></span></p>
        <p><label>First Name:</label> <span id="firstName"></span></p>
        <p><label>Phone Number:</label> <span id="phoneNumber"></span></p>
        <p><label>Address:</label> <span id="address"></span></p>
        <p><label>Email:</label> <span id="email"></span> <button onclick="openChangeEmailForm()">Change Email</button></p>
        <p><label>Profile Picture:</label> <img id="profilePicture" src="#" alt="Profile Picture" width="100"></p>
        <input type="file" id="fileInput">
        <button onclick="uploadProfilePicture()">Upload Profile Picture</button>
    </div>
    <div class="change-email-form" style="display: none;">
        <h2>Change Email</h2>
        <div class="form-group">
            <label for="newEmail">New Email:</label>
            <input type="email" id="newEmail">
        </div>
        <button onclick="changeEmail()">Submit</button>
    </div>
    <div class="change-password-form" style="display: none;">
        <h2>Change Password</h2>
        <div class="form-group">
            <label for="oldPassword">Old Password:</label>
            <input type="password" id="oldPassword">
        </div>
        <div class="form-group">
            <label for="newPassword">New Password:</label>
            <input type="password" id="newPassword">
        </div>
        <button onclick="changePassword()">Change Password</button>
    </div>
    <div class="delete-account">
        <button onclick="deleteAccount()">Delete Account</button>
    </div>
</div>-->
<div class="container">
    <div class="main-body">

        <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex flex-column align-items-center text-center">
                            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" id="profilePic" alt="Admin" class="rounded-circle" width="150">
                            <label for="fileInputBtn" class="btn btn-primary">Change photo</label>
                            <input type="file" accept="image/png, image/gif, image/jpeg" style="display: none" id="fileInputBtn"/>
                            <div class="mt-3">
                                <h4 id="fullName"></h4>
<!--                                <p class="text-secondary mb-1">Full Stack Developer</p>-->
                                <p class="text-muted font-size-sm">Bay Area, San Francisco, CA</p>
                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteProfileModal">Delete account</button>
<!--                                <button class="btn btn-outline-primary">Message</button>-->
                            </div>
                        </div>
                    </div>
                </div>
<!--                <div class="card mt-3">-->
<!--                    <ul class="list-group list-group-flush">-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">-->
<!--                            <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe mr-2 icon-inline"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>Website</h6>-->
<!--                            <span class="text-secondary">https://bootdey.com</span>-->
<!--                        </li>-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">-->
<!--                            <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github mr-2 icon-inline"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>Github</h6>-->
<!--                            <span class="text-secondary">bootdey</span>-->
<!--                        </li>-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">-->
<!--                            <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter mr-2 icon-inline text-info"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>Twitter</h6>-->
<!--                            <span class="text-secondary">@bootdey</span>-->
<!--                        </li>-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">-->
<!--                            <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram mr-2 icon-inline text-danger"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>Instagram</h6>-->
<!--                            <span class="text-secondary">bootdey</span>-->
<!--                        </li>-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">-->
<!--                            <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook mr-2 icon-inline text-primary"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>Facebook</h6>-->
<!--                            <span class="text-secondary">bootdey</span>-->
<!--                        </li>-->
<!--                    </ul>-->
<!--                </div>-->
            </div>
            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Full Name</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                <span id="firstName"></span>
                                <span id="lastName"></span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Email</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                <span id="email"></span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Phone</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                <span id="phoneNumber"></span>
                            </div>
                        </div>
                        <hr>

                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Address</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                <span id="address"></span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="btn btn-info " data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change password</div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Change password</h1>
                <button type="button" id="closeChangePasswordModal" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                    <div class="mb-3">
                        <label for="oldPasswordInput" class="form-label">Old password</label>
                        <input type="password" class="form-control" id="oldPasswordInput">
                    </div>
                    <div class="mb-3">
                        <label class="form-check-label" for="newPasswordInput">New password</label>
                        <input type="password" class="form-control" id="newPasswordInput">
                    </div>
                    <button type="submit" id="changePasswordBtn" class="btn btn-success">Submit</button>
            </div>
            <span style="display: none" id="successMessage">Password has changed successfully</span>
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--                <button type="button" class="btn btn-primary">Save changes</button>-->
<!--            </div>-->
        </div>
    </div>
</div>

<div class="modal fade" id="deleteProfileModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel1">Do you want to delete account?</h1>
                <button type="button" id="closeChangePasswordModal1" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are u sure?
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px">
                        <button class="btn btn-danger" id="deleteAccountBtn">Yes</button>
                        <button class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                </div>
            </div>
            <!--            <div class="modal-footer">-->
            <!--                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
            <!--                <button type="button" class="btn btn-primary">Save changes</button>-->
            <!--            </div>-->
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script>
    /*function getUserProfile() {
        // Use your API endpoint to get user profile data
        // Update the HTML elements with the retrieved data
        // Example:
        document.getElementById('username').innerText = 'JohnDoe';
        document.getElementById('firstName').innerText = 'John';
        document.getElementById('phoneNumber').innerText = '1234567890';
        document.getElementById('address').innerText = '123 Main St, City';
        document.getElementById('email').innerText = 'john@example.com';
        document.getElementById('profilePicture').src = 'https://via.placeholder.com/100';
    }*/
    function getUserProfile() {
        const token = localStorage.getItem("jwtToken")
        fetch('http://localhost:8080/users/getProfile', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
                // You may need to include additional headers like Authorization token if required by your backend
            }
        })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401)
                    {
                        location.href = 'registration.html'
                    }
                    throw new Error('Failed to fetch user profile');
                }
                return response.json();
            })
            .then(data => {
                // Update the HTML elements with the retrieved user profile data
                // console.log(document.getElementById('firstName'))
                let fullName = data.firstName + ' ' + data.lastName;

                document.getElementById('fullName').innerText = fullName;
                document.getElementById('email').innerText = data.email;
                document.getElementById('firstName').innerText = data.firstName;
                document.getElementById('lastName').innerText = data.lastName;
                document.getElementById('phoneNumber').innerText = data.phoneNumber ? data.phoneNumber : 'not set';
                document.getElementById('address').innerText = data.address === "null" ? "not set" : data.address;
                document.getElementById('profilePic').src = data.photo;
            })
            .catch(error => {
                console.error('Error fetching user profile:', error);
            });
    }

    document.getElementById("changePasswordBtn").addEventListener("click", changePassword)
    document.getElementById("deleteAccountBtn").addEventListener("click", deleteAccount)
    document.getElementById("fileInputBtn").addEventListener("change", uploadProfilePicture)

    function openChangeEmailForm() {
        document.querySelector('.change-email-form').style.display = 'block';
    }

    function changeEmail() {
        // Implement logic to change email using your API endpoint
        // Retrieve new email from input field and make API call
        // Example:
        var newEmail = document.getElementById('newEmail').value;
        console.log('Changing email to: ' + newEmail);
        // Make API call to change email
    }

    function uploadProfilePicture() {
        // Implement logic to upload profile picture using your API endpoint
        // Retrieve file from input field and make API call
        // Example:
        let file = document.getElementById('fileInputBtn').files[0];
        let data = new FormData()
        data.append('file', file)
        const token = localStorage.getItem("jwtToken")
        fetch('http://localhost:8080/users/uploadPhoto', {
            method: 'PATCH',
            body: data,
            headers: {
                /*'Content-Type': "multipart/form-data",*/
                'Authorization': 'Bearer ' + token
                // You may need to include additional headers like Authorization token if required by your backend
            }
        })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401)
                    {
                         location.href = 'registration.html'
                    }
                    throw new Error('Failed to fetch user profile');
                }
                return response.json();
            })
            .then(data => {

            })
            .catch(error => {
                console.error('Error fetching user profile:', error);
            })
        // Make API call to upload profile picture
    }

    function changePassword() {
        const token = localStorage.getItem("jwtToken")
        let oldPassword = document.getElementById('oldPasswordInput').value;
        let newPassword = document.getElementById('newPasswordInput').value;

        let passwordData = {oldPassword, newPassword}
        fetch('http://localhost:8080/users/changePassword', {
            method: 'POST',
            body: JSON.stringify(passwordData),
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
                // You may need to include additional headers like Authorization token if required by your backend
            }
        })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401)
                    {
                        location.href = 'registration.html'
                    }
                    throw new Error('Failed to fetch user profile');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("successMessage").style.display = "block"

                setTimeout(() => {
                    document.getElementById("successMessage").style.display = "none"
                    document.getElementById("closeChangePasswordModal").click()
                }, 2000)
            })
            .catch(error => {
                console.error('Error fetching user profile:', error);
            })
        .finally(() =>{
            document.getElementById("successMessage").style.display = "block"

            setTimeout(() => {
                document.getElementById("successMessage").style.display = "none"
                document.getElementById("closeChangePasswordModal").click()
            }, 2000)
        });
        // Make API call to change password
    }

    async function deleteAccount() {
        // Implement logic to delete account using your API endpoint
        const token = localStorage.getItem("jwtToken")

        try
        {
            const response = await fetch("http://localhost:8080/users/deleteAccount", {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                    // You may need to include additional headers like Authorization token if required by your backend
                }
            });
            document.getElementById("closeChangePasswordModal1").click()

        }
        catch (error){
        console.log(error)
        }

        // Make API call to delete account
    }

    // Load user profile when the page loads
    window.onload = function() {
        getUserProfile();
    };
</script>
</body>
</html>
